<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Presente de Casamento - PIX</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 12px;
    }
    h2, h3, h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .valor-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      justify-content: center;
    }
    .valor-buttons button {
      flex: 1 1 30%;
      cursor: pointer;
    }
    #pagador-section, #qr, #countdown {
      margin-top: 20px;
    }
    #apoiadores {
      margin-top: 30px;
      border-top: 1px solid #ccc;
      padding-top: 20px;
    }
    .apoiador {
      margin-bottom: 10px;
      padding: 8px;
      background-color: #f2f2f2;
      border-radius: 6px;
    }
    .apoiador p {
      margin: 4px 0;
    }
    /* Estilo do ret√¢ngulo simulando v√≠deo */
    #liveVideo {
      margin-top: 50px;
      width: 100%;
      height: 250px;
      background: #000 url('https://via.placeholder.com/480x250.png?text=Live+do+Casamento') center center no-repeat;
      background-size: cover;
      border-radius: 12px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #liveVideo button {
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }
    #liveVideo button:hover {
      background: rgba(255,255,255,1);
    }

    /* Modal simples */
    #modalOverlay {
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      display:none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #modalContent {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    #modalContent button {
      margin-top: 20px;
      padding: 10px 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Se√ß√£o 1: Mensagem -->
  <h2>Deixe uma mensagem para o casal</h2>
  <form id="mensagem-form" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" target="_blank">
    <label for="nome">Seu Nome</label>
    <input type="text" id="nome" name="nome" placeholder="Ex: Jo√£o Silva" required>

    <label for="mensagem">Mensagem</label>
    <textarea id="mensagem" name="mensagem" placeholder="Parab√©ns pelo casamento!" rows="3" required></textarea>

    <button type="submit">Enviar Mensagem</button>
  </form>

  <!-- Se√ß√£o 2: Presentes / Pagamento PIX -->
  <h2>Presentes - Escolha um valor</h2>
  <div class="valor-buttons">
    <button type="button" onclick="preencherValor(10)">R$ 10</button>
    <button type="button" onclick="preencherValor(20)">R$ 20</button>
    <button type="button" onclick="preencherValor(30)">R$ 30</button>
    <button type="button" onclick="preencherValor(40)">R$ 40</button>
    <button type="button" onclick="preencherValor(50)">R$ 50</button>
  </div>

  <div id="pagador-section" style="display:none;">
    <label for="email">Email do Pagador</label>
    <input type="email" id="email" required value="">

    <label for="descricao">Descri√ß√£o</label>
    <input type="text" id="descricao" value="Presente do Casamento" readonly>

    <label for="valor">Valor (R$)</label>
    <input type="number" id="valor" step="0.01" required value="">

    <button type="button" onclick="enviarPagamento()">Gerar PIX</button>
  </div>

  <div id="qr"></div>

  <!-- Se√ß√£o 3: Live do casamento -->
  <h1>Live do Casamento</h1>
  <div id="liveVideo">
    <button onclick="iniciarLive()">‚ñ∂</button>
  </div>

  <!-- Contagem regressiva abaixo da live -->
  <h2>Contagem regressiva para o casamento</h2>
  <div id="countdown" style="text-align:center; font-size: 1.5em;"></div>

  <!-- Se√ß√£o 4: Lista de quem ajudou -->
  <h2>Quem j√° ajudou</h2>
  <div id="apoiadores"></div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modalContent">
      <p id="modalMessage"></p>
      <button onclick="fecharModal()">Fechar</button>
    </div>
  </div>

  <script>
    // JSON inicial de apoiadores
    const apoiadoresData = [
      { nome: "Ana", mensagem: "Parab√©ns ao casal!" },
      { nome: "Carlos", mensagem: "Muita felicidade!" },
      { nome: "Mariana", mensagem: "Tudo de bom!" }
    ];

    function renderApoiadores() {
      const container = document.getElementById('apoiadores');
      container.innerHTML = '';
      apoiadoresData.forEach(apoiador => {
        const div = document.createElement('div');
        div.classList.add('apoiador');
        div.innerHTML = `
          <p><strong>${apoiador.nome}</strong></p>
          <p>${apoiador.mensagem}</p>
        `;
        container.appendChild(div);
      });
    }

    renderApoiadores();

    function preencherValor(valor) {
      document.getElementById('valor').value = valor;
      document.getElementById('pagador-section').style.display = 'block';
    }

    async function enviarPagamento() {
      const email = document.getElementById('email').value;
      const descricao = document.getElementById('descricao').value;
      const valor = parseFloat(document.getElementById('valor').value);

      const resposta = await fetch('https://presente-api-1.onrender.com/pagar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          payer_email: email,
          description: descricao,
          transaction_amount: valor
        })
      });

      const data = await resposta.json();

      const qrDiv = document.getElementById('qr');
      if (data.point_of_interaction?.transaction_data?.qr_code_base64) {
        qrDiv.innerHTML = `
          <h3>Escaneie o QR Code</h3>
          <img src="data:image/png;base64,${data.point_of_interaction.transaction_data.qr_code_base64}" alt="QR Code PIX">
          <h4>C√≥digo PIX</h4>
          <code>${data.point_of_interaction.transaction_data.qr_code}</code>
        `;

        // Adiciona √† lista de apoiadores ap√≥s pagamento
        const nome = document.getElementById('nome').value || "An√¥nimo";
        const mensagem = document.getElementById('mensagem').value || "";
        apoiadoresData.push({ nome, mensagem });
        renderApoiadores();

        // Inicia contagem de 1 minuto
        setTimeout(() => {
          mostrarModal("Tempo esgotado! Voc√™ conseguiu efetuar o pagamento?\nClique Fechar para continuar.");
        }, 60 * 1000); // 60 segundos
      } else {
        qrDiv.innerHTML = `<p>Erro: ${JSON.stringify(data)}</p>`;
      }
    }

    function mostrarModal(mensagem) {
      document.getElementById('modalMessage').innerText = mensagem;
      document.getElementById('modalOverlay').style.display = 'flex';
    }

    function fecharModal() {
      document.getElementById('modalOverlay').style.display = 'none';
      location.reload();
    }

    // Contagem regressiva para 1 de novembro deste ano, 15:00
    const agora = new Date();
    const anoAtual = agora.getFullYear();
    const casamentoData = new Date(anoAtual, 10, 1, 15, 0, 0); // Novembro = 10

    function atualizarContagem() {
      const agora = new Date();
      const diff = casamentoData - agora;

      if (diff <= 0) {
        document.getElementById('countdown').innerHTML = "√â o grande dia! üéâ";
        clearInterval(intervalo);
        return;
      }

      const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
      const horas = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutos = Math.floor((diff / (1000 * 60)) % 60);
      const segundos = Math.floor((diff / 1000) % 60);

      document.getElementById('countdown').innerHTML =
        `${dias} dias, ${horas}h ${minutos}m ${segundos}s`;
    }

    atualizarContagem();
    const intervalo = setInterval(atualizarContagem, 1000);

    function iniciarLive() {
      alert("Fun√ß√£o de iniciar live aqui!");
    }
  </script>
</body>
</html>
